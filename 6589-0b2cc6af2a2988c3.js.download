"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6589],{1191:(e,t,a)=>{a.d(t,{C:()=>I,ImportFromFigmaModal:()=>M});var l=a(7336),n=a(80644),r=a(38559),s=a(81616),i=a(52220),o=a(4304),d=a(3816),c=a(52014),u=a(70505),m=a(96378),h=a(79822),f=a(51621),g=a(9097),x=a(2115),p=a(67952),v=a(14416),j=a(80944),b=a(59103),C=a(17777),w=a(91064),y=a(88194);function N(e){let{inputRef:t,inputValue:a,setInputValue:n,urlError:d,setUrlError:u,handleImport:x,handleClose:v,isLoading:j}=e,b=(0,p.k)("figmaIntegration");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.ModalHeader,{className:"flex justify-start p-5",children:(0,l.jsxs)("div",{className:"flex w-full flex-col items-start gap-2",children:[(0,l.jsxs)("div",{className:"bg-muted/50 relative h-[180px] w-full rounded-md",children:[(0,l.jsx)(m.default,{src:"/chat-static/figma-integration-light.svg",alt:"",className:"h-full w-full rounded-md object-cover dark:hidden",fill:!0,priority:!0}),(0,l.jsx)(m.default,{src:"/chat-static/figma-integration-dark.svg",alt:"",className:"hidden h-full w-full rounded-md object-cover dark:block",fill:!0,priority:!0})]}),(0,l.jsxs)("div",{className:"flex w-full flex-col items-start gap-2",children:[(0,l.jsx)(r.ModalTitle,{className:"text-xl font-semibold",children:b("importFromFigma")}),(0,l.jsxs)("form",{className:"flex w-full flex-col space-y-3",onSubmit:e=>{e.preventDefault(),x()},children:[(0,l.jsx)("div",{className:"text-left text-sm text-gray-900",children:(0,l.jsx)(r.ModalDescription,{children:b("importFigmaDescription")})}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)(i.p,{ref:t,type:"url",size:"sm",placeholder:b("enterFigmaUrl"),className:(0,g.cn)("bg-subtle w-full",d&&"border-red-500"),value:a,onChange:e=>{n(e.target.value),d&&u(null)}}),(0,l.jsx)(h.N,{mode:"sync",children:d&&(0,l.jsx)(f.P.div,{initial:{height:0,opacity:0,y:-8},animate:{height:"auto",opacity:1,y:0},exit:{height:0,opacity:0,y:-8},transition:{duration:.15,ease:"easeOut"},children:(0,l.jsxs)("span",{className:"flex items-center gap-2 whitespace-nowrap text-red-500",children:[(0,l.jsx)(c.V,{className:"h-4 w-4 shrink-0"}),(0,l.jsx)("span",{className:"truncate text-sm",children:d})]})})})]})]})]})]})}),(0,l.jsx)(r.ModalFooter,{className:"border-border bg-muted border-t !p-4",children:(0,l.jsxs)("div",{className:"flex w-full items-center justify-end gap-2",children:[(0,l.jsx)(r.ModalClose,{asChild:!0,disabled:j,children:(0,l.jsx)(s.$,{onClick:v,size:"sm",variant:"secondary",disabled:j,children:b("cancel")})}),(0,l.jsx)(o.Q,{onClick:x,size:"sm",pending:j,autoFocus:!0,children:b("next")})]})})]})}function F(e){let{color:t}=e;return(0,l.jsxs)("div",{className:"flex items-center gap-1 rounded-md border p-1",children:[(0,l.jsx)("div",{className:"h-4 w-4 rounded-sm border",style:{backgroundColor:t.hex}}),(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("span",{className:"text-muted-foreground text-xs",children:t.hex.toLowerCase()})})]})}function S(e){let{imageBase64:t,originalFigmaUrl:a,nodeContext:n,handleImport:i,handleClose:c,isLoading:h,imageHeight:f}=e,g=(0,p.k)("figmaIntegration");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"max-h-[calc(100vh-8rem)] overflow-y-auto",children:(0,l.jsx)(r.ModalHeader,{className:"flex w-full flex-col p-3 md:p-5",children:(0,l.jsxs)("div",{className:"flex w-full flex-col gap-3 md:gap-4",children:[(0,l.jsx)(r.ModalTitle,{className:"text-left text-lg font-semibold md:text-xl",children:g("heresWhatWellImport")}),(0,l.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,l.jsx)("h3",{className:"text-left text-sm font-medium md:text-base",children:g("visualContext")}),f&&f/2>982&&(0,l.jsxs)(y.Fc,{children:[(0,l.jsx)(u.A,{className:"h-4 w-4"}),(0,l.jsx)(y.TN,{children:g("heightWarning")})]}),(0,l.jsx)("div",{className:"bg-muted/50 relative h-[200px] w-full rounded-md border md:h-[400px]",children:t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.default,{src:t,alt:"Figma design preview",className:"rounded-md object-cover object-top",fill:!0,sizes:"100vw",priority:!0}),(0,l.jsx)("div",{className:"absolute bottom-2 right-2 z-10 md:bottom-3 md:right-3",children:(0,l.jsx)(w.N,{href:a,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),passHref:!0,children:(0,l.jsxs)(C.E,{className:"bg-muted hover:bg-muted/50 max-w-[200px] cursor-pointer truncate text-xs md:text-sm",variant:"secondary",children:[(0,l.jsx)(d.Y,{className:"h-3 w-3 shrink-0"}),(0,l.jsx)("span",{className:"truncate",children:n.frameName||g("openInFigma")})]})})})]})}),(0,l.jsx)("div",{className:"mt-3 flex flex-col space-y-3",children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-6",children:[n.nodes.designTokens.length>0&&(0,l.jsxs)("div",{className:"mb-6 flex flex-1 flex-col gap-2 md:mb-0",children:[(0,l.jsx)("h3",{className:"text-left text-sm font-medium md:text-base",children:g("designTokens")}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:n.nodes.designTokens.map((e,t)=>(0,l.jsx)(F,{color:e},e.hex||t))})]}),n.nodes.colors.length>0&&(0,l.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[(0,l.jsx)("h3",{className:"text-left text-sm font-medium md:text-base",children:g("colors")}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:n.nodes.colors.map((e,t)=>(0,l.jsx)(F,{color:e},e.hex||t))})]})]})})]})]})})}),(0,l.jsx)(r.ModalFooter,{className:"border-border bg-muted sticky bottom-0 border-t !p-3 md:!p-4",children:(0,l.jsxs)("div",{className:"flex w-full items-center justify-end gap-2",children:[(0,l.jsx)(r.ModalClose,{asChild:!0,disabled:h,children:(0,l.jsx)(s.$,{onClick:c,size:"sm",variant:"secondary",disabled:h,children:g("cancel")})}),(0,l.jsx)(o.Q,{onClick:i,size:"sm",pending:h,autoFocus:!0,children:g("confirm")})]})})]})}function M(){var e;let t=(0,p.k)("figmaIntegration"),{importFigmaModalOpen:a,setImportFigmaModalOpen:s}=I(),{setSignInWithFigmaModal:i}=(0,j.f)(),[o,d]=(0,n.useState)("url"),[c,u]=(0,n.useState)(null),[m,h]=n.useState(null),f=n.useRef(null),[b,C]=n.useState(""),[w,y]=n.useState(""),F=(0,v.q)(f);(0,n.useEffect)(()=>{if((null==a?void 0:a.open)&&!F.isSignedIn){var e,t;s(null),i({figmaOauthUrl:"".concat(null!==(t=null===(e=F.userData)||void 0===e?void 0:e.figmaOauthUrl)&&void 0!==t?t:"","&from=import")})}},[F.isSignedIn,null==a?void 0:a.open,s,i,null===(e=F.userData)||void 0===e?void 0:e.figmaOauthUrl]);let M=()=>{s(null),h(null),C(""),d("url"),f.current&&(f.current.value="")},U=()=>{M(),(0,x.u)("FigmaModalClose")},k=async()=>{if(!b){let e=t("enterValidUrl");h(e),(0,x.u)("FigmaUrlSubmit",{url:"",success:!1,error:e});return}try{await T(b)}catch(e){(0,x.u)("FigmaUrlSubmit",{url:b,success:!1,error:e instanceof Error?e.message:"Unknown error"})}},T=async e=>{let l,n=!1;if("url"===o){if(F.isFigmaUrl(e))try{let[a,n]=await Promise.all([F.getNodeContext(e),F.handleFigmaUrl(e)]);n.success?(u(a),y(n.data.base64),h(null),d("context")):(l=n.error||t("invalidUrl"),h(l))}catch(e){l=e instanceof Error?e.message:"Error loading Figma content",h("Error loading Figma content")}else h(l=t("invalidUrl"))}else(await F.handleFigmaUrl(e)).success&&(null==a?void 0:a.onImport)?(U(),await a.onImport(e),n=!0):h(l="Failed to import Figma URL");(0,x.u)("FigmaUrlSubmit",{url:e,success:n,error:l})};return a?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Modal,{onClose:U,onOpenChange:F.isLoading?void 0:M,open:!!a,className:(0,g.cn)("w-full","url"===o?"max-w-xl":"md:!w-[800px]"),children:(0,l.jsx)("div",{className:"flex w-full flex-col",children:c?"url"===o?(0,l.jsx)(N,{inputRef:f,inputValue:b,setInputValue:C,urlError:m,setUrlError:h,handleImport:k,handleClose:U,isLoading:F.isLoading}):(0,l.jsx)(S,{imageBase64:w,originalFigmaUrl:b,nodeContext:c,handleImport:k,handleClose:U,isLoading:F.isLoading,imageHeight:F.imageHeight}):(0,l.jsx)(N,{inputRef:f,inputValue:b,setInputValue:C,urlError:m,setUrlError:h,handleImport:k,handleClose:U,isLoading:F.isLoading})})}),(0,l.jsx)(j.default,{})]}):null}function I(){let{data:e,mutate:t}=(0,b.Ay)("useImportFromFigmaModal",null);return{importFigmaModalOpen:e,setImportFigmaModalOpen:t,figmaContext:null==e?void 0:e.figmaContext}}},4146:(e,t,a)=>{a.r(t),a.d(t,{createRouteFetcherForAction:()=>r});var l=a(59103);let n=new Map;function r(e){return async t=>{let a="".concat(e.method,":").concat(e.path,":").concat((0,l.WI)([t])),r=Date.now(),s=n.get(a);if(s&&s.expiry>r)return s.promise;for(let[e,t]of n.entries())t.expiry<=r&&n.delete(e);let i=e.path,o=e.path.match(/\[([^\]]+)\]/g)||[];for(let e of o){let a=e.slice(1,-1),l=t[a];if(void 0===l)throw Error("Missing required parameter: ".concat(a));i=i.replace(e,encodeURIComponent(String(l)))}if("GET"===e.method){let e=new URLSearchParams;Object.entries(t).forEach(t=>{let[a,l]=t;o.includes("[".concat(a,"]"))||void 0===l||e.append(a,String(l))});let a=e.toString();a&&(i+="?".concat(a))}let d=(async()=>{let a;let l=e.method;if(!(a="GET"===l?await fetch(i):await fetch(i,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok){let e=await a.json().catch(()=>null);throw Error("HTTP error ".concat(a.status,": ").concat((null==e?void 0:e.error)||a.statusText))}return a.json()})();return n.set(a,{promise:d,expiry:r+500}),d}}},4304:(e,t,a)=>{a.d(t,{Q:()=>i});var l=a(7336),n=a(97210),r=a(81616),s=a(4495);function i(e){let{children:t,pending:a,spinnerSide:i="left",hideTextWhenPending:o=!1,innerClassName:d,...c}=e,u=a?(0,l.jsx)(n.y,{size:16}):null,m=o?null:u,h=o?(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:u}):null;return(0,l.jsxs)(r.$,{size:"sm",...c,disabled:c.disabled||a,className:(0,s.cn)("relative",c.className),children:[h,(0,l.jsxs)("div",{className:(0,s.cn)("flex items-center justify-center gap-2 transition-opacity",o&&a&&"opacity-0",d),children:["left"===i?m:null,t,"right"===i?m:null]})]})}},7222:(e,t,a)=>{a.d(t,{M:()=>l});let l=(0,a(27007).zp)()},14416:(e,t,a)=>{a.d(t,{q:()=>o});var l=a(80644),n=a(23063),r=a(59103),s=a(80944);let i=/^https:\/\/www\.figma\.com\/(?:file|design)\/[a-zA-Z0-9]+(?:\/[^\/]+)?\/?\?node-id=[0-9]+-[0-9]+(?:&node-type=(?:frame|component|section))?(?:&t=[a-zA-Z0-9-]+)?(?:&m=dev)?(?:&t=[a-zA-Z0-9-]+)?$/;function o(e){let t=(0,n.D)(),{setSignInWithFigmaModal:a}=(0,s.f)(),{data:o,isLoading:d}=(0,r.Ay)("integrations:figma",{fallbackData:{isSignedIn:!1,figmaOauthUrl:""}}),[c,u]=(0,l.useState)({imageBase64:null,originalUrl:null,fileName:null,isScreenshotLoading:!1,isContextLoading:!1,error:null,nodeContext:null}),m=(0,l.useCallback)(e=>t.fi&&!d&&i.test(e),[t.fi,d]),h=(0,l.useCallback)(async t=>{var l,n;let r=t||(null===(l=e.current)||void 0===l?void 0:l.value)||"";if(!r)return{success:!1,reason:"invalid_url"};if(!m(r))return{success:!1,reason:r.includes("figma.com")?"missing_node":"invalid_url"};if(u(e=>({...e,originalUrl:r,isScreenshotLoading:!0})),!(null==o?void 0:o.isSignedIn))return a({figmaOauthUrl:null!==(n=null==o?void 0:o.figmaOauthUrl)&&void 0!==n?n:""}),u(e=>({...e,isScreenshotLoading:!1})),{success:!1,needsAuth:!0};try{let e=await fetch("/chat/api/integrations/figma/get-screenshot?url=".concat(encodeURIComponent(r)));if(401===e.status)return a({figmaOauthUrl:o.figmaOauthUrl}),u(e=>({...e,imageBase64:null,originalUrl:null,fileName:null,isScreenshotLoading:!1,isContextLoading:!1,error:"Authentication required",nodeContext:null})),{success:!1,needsAuth:!0};if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to fetch Figma image")}let t=await e.json(),l=new URL(r).pathname.split("/").pop()||"Figma Design",n={success:!0,data:{base64:t.base64,originalUrl:t.originalUrl,fileName:l}};return u(e=>({...e,imageBase64:t.base64,originalUrl:t.originalUrl,fileName:l,isScreenshotLoading:!1,error:null,nodeContext:JSON.stringify(t,null,0),imageHeight:t.height})),n}catch(t){console.error("Error fetching Figma image:",t);let e=t instanceof Error?t.message:"Failed to fetch image";return u(t=>({...t,imageBase64:null,originalUrl:null,fileName:null,isScreenshotLoading:!1,error:e,nodeContext:null})),{success:!1,error:e}}},[e,m,null==o?void 0:o.isSignedIn,null==o?void 0:o.figmaOauthUrl,a]),f=(0,l.useCallback)(async e=>{try{u(e=>({...e,isContextLoading:!0,error:null}));let t=await fetch("/chat/api/integrations/figma/context?url=".concat(encodeURIComponent(e))),a=await t.json();return u(e=>({...e,isContextLoading:!1,nodeContext:JSON.stringify(a,null,0)})),a}catch(t){let e=t instanceof Error?t.message:"Failed to fetch context";throw u(t=>({...t,isContextLoading:!1,error:e})),t}},[]);return(0,l.useMemo)(()=>{var e;return{...c,isLoading:c.isScreenshotLoading||c.isContextLoading||d,isFigmaLoading:d,handleFigmaUrl:h,isFigmaUrl:m,isSignedIn:!d&&null!==(e=null==o?void 0:o.isSignedIn)&&void 0!==e&&e,userData:o,getNodeContext:f}},[c,h,m,o,f,d])}},20802:(e,t,a)=>{a.d(t,{Kv:()=>l});function l(e){return function(e,t){let a,l="";for(let t=e.length-1;t>=0;t--){if("-"===e[t]&&l.length>=7){a=e.slice(0,t);break}l=e[t]+l}return!a&&l.length<e.length&&(a=e.slice(0,e.length-l.length-1)),{id:l,title:a||void 0}}(e,7).id}},22705:(e,t,a)=>{a.d(t,{ScopedSWRDataProvider:()=>o,j:()=>d});var l=a(7336),n=a(80644),r=a(56999),s=a(75480);let i=(0,n.createContext)({});function o(e){let{children:t,actions:a}=e,r=(0,n.useMemo)(()=>a,[a]);return(0,l.jsx)(i.Provider,{value:r,children:t})}let d=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.B)(i,(0,s.P4)(),...t)}},23063:(e,t,a)=>{a.d(t,{D:()=>i,FlagsProvider:()=>s});var l=a(7336),n=a(80644);let r=(0,n.createContext)(null);function s(e){let{children:t,promise:a,middlewareFlags:s}=e,i={};for(let e of s)i[e]=!0;let[o,d]=(0,n.useState)(i);return(0,n.useEffect)(()=>{a.then(e=>{(0,n.startTransition)(()=>{d(e)})})},[a]),(0,l.jsx)(r.Provider,{value:o,children:t})}function i(){let e=(0,n.useContext)(r);if(null===e)throw Error("");return e}},27362:(e,t,a)=>{a.d(t,{UpdateChatTitleDialog:()=>I,d:()=>M});var l=a(7336),n=a(80644),r=a(81616),s=a(38559),i=a(30009);let o=(0,i.createServerReference)("40fff0da781db209e15f961bb48d68e4192e478e50",i.callServer,void 0,i.findSourceMapURL,"updateChatTitle");var d=a(57748),c=a(10299),u=a(15993),m=a(52220),h=a(59103),f=a(80890),g=a(75720),x=a(64854),p=a(88551),v=a(82399),j=a(72633),b=a(58659),C=a(67952),w=a(87825),y=a(85328),N=a(20802),F=a(22705);let S=j.z.object({title:j.z.string().min(1,"Title is required").max(100,"Title must be less than 100 characters")});function M(){let{data:e,mutate:t}=(0,h.Ay)("showUpdateChatTitleDialogForChatId",null);return{showUpdateChatTitleDialogForChatId:e,setUpdateChatTitleDialogForChatId:t}}function I(){let{showUpdateChatTitleDialogForChatId:e,setUpdateChatTitleDialogForChatId:t}=M(),a=(0,c.useRouter)(),[i,h]=(0,n.useTransition)(),{title:j,setMetadata:I}=(0,d.tZ)(),[U,k]=(0,n.useState)(""),T=(0,w.cy)(),{setMobileSheetOpen:E}=(0,g.e)(),{data:D,setData:L}=(0,x.m)(),{data:O,setData:R}=(0,x.r)(),[z,P]=(0,n.useState)(""),A="string"==typeof T.id?(0,N.Kv)(T.id):null,W=n.useRef(null),H=(0,C.k)("updateChatTitleDialog"),$=(0,y.al)(),{data:_,mutate:V}=(0,F.j)({},"getChats");(0,n.useEffect)(()=>{t(null)},[t]),(0,n.useEffect)(()=>{if(e){let t=null==D?void 0:D.find(t=>t.chatId===e);P((null==t?void 0:t.title)||j||""),k((null==t?void 0:t.title)||j||"")}},[e,D,j]),(0,n.useEffect)(()=>{e&&setTimeout(()=>{var e,t;null===(e=W.current)||void 0===e||e.focus(),$||null===(t=W.current)||void 0===t||t.select()},0)},[e,$]);let B=(0,n.useCallback)(()=>{e&&h(async()=>{try{let a=await V({serverMutate:o({chatId:e,title:U.trim()||"Untitled"}),optimisticData:{favorites:_.favorites.map(t=>t.chatId===e?{...t,title:U.trim()||"Untitled"}:t),history:_.history.map(t=>t.chatId===e?{...t,title:U.trim()||"Untitled"}:t)}}),l=null==O?void 0:O.find(t=>t.chatId===e);if("success"in a)l&&R(t=>t.map(t=>t.chatId===e?{...t,title:U.trim()||"Untitled"}:t)),(null==D?void 0:D.find(t=>t.chatId===e))&&L(t=>t.map(t=>t.chatId===e?{...t,title:U.trim()||"Untitled"}:t)),A===e&&I({title:U.trim()||"Untitled"}),u.oR.success(H("successToast")),A!==e&&A||E(!1),t(null);else throw Error(v.YK)}catch(e){(0,p.z)(e,a)||u.oR.error("Failed to update chat title. Please try again."),R(()=>O||[]),L(()=>D||[])}})},[e,O,U,D,A,H,t,R,L,I,E,a]),q=(0,n.useCallback)(()=>{t(null)},[t]),J=(0,n.useCallback)(e=>{e.preventDefault();let t=S.safeParse({title:U});if(!t.success){var a;let e=t.error.flatten().fieldErrors;u.oR.error((null===(a=e.title)||void 0===a?void 0:a[0])||"Invalid title");return}B()},[B,U]);return(0,l.jsx)(s.Modal,{onOpenChange:e=>{e||t(null)},open:null!==e,children:(0,l.jsxs)("form",{onSubmit:J,children:[(0,l.jsxs)(s.ModalHeader,{children:[(0,l.jsx)(s.ModalTitle,{children:H("title")}),(0,l.jsxs)(s.ModalDescription,{children:[(0,l.jsx)("label",{className:"sr-only",htmlFor:"newChatTitle",children:H("newChatTitle")}),(0,l.jsx)(m.p,{"aria-label":H("newChatTitle"),autoComplete:"off",autoFocus:!0,className:"w-full",id:"newChatTitle",maxLength:100,onChange:e=>k(e.target.value),placeholder:z||H("enterNewTitle"),ref:W,value:U}),(0,l.jsx)(b.j,{className:"mt-2",count:U.length,max:100,message:"Title must be less than ".concat(100," characters")})]})]}),(0,l.jsxs)(s.ModalFooter,{children:[(0,l.jsx)(r.$,{onClick:q,size:"sm",type:"button",variant:"secondary",children:H("cancel")}),(0,l.jsx)(r.$,{disabled:i,size:"sm",type:"submit",children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.X,{"aria-hidden":"true",className:"size-4"}),(0,l.jsx)("span",{children:H("saving")})]}):H("save")})]})]})})}},39695:(e,t,a)=>{a.d(t,{NewSidebarProvider:()=>i,t:()=>s});var l=a(7336),n=a(80644);let r=(0,n.createContext)(void 0);function s(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useNewSidebarEnabled must be used within a NewSidebarProvider");return e}let i=e=>{let{value:t,children:a}=e;return(0,l.jsx)(r.Provider,{value:t,children:a})}},56999:(e,t,a)=>{a.d(t,{B:()=>m});var l=a(4146),n=a(72478),r=a(80644),s=a(59103),i=a(60260),o=a(7222);let d=new Map,c=new Map,u=new Set;function m(e,t,a,m,h){let f=(0,r.useId)(),g=(0,r.useContext)(e),x=(0,r.useMemo)(()=>g[m],[g,m]),p=null==h?void 0:h.bypassServerPromiseIfAtomHasData;if(!g||!x)throw Error(["Called a use*ContextSWR hook outside of *SWRDataProvider: ".concat(String(m)),"Missing context:","  useContext(context): ".concat(JSON.stringify(g)),"  action = context[actionKey]: ".concat(JSON.stringify(x))].join("\n"));let{actionRoute:v,serverPromise:j}=x,b=t[m],C=(0,i.md)(b),w=(0,r.useCallback)(e=>o.M.set(b,e),[b]),y=(0,r.useMemo)(()=>(0,s.WI)([new Date().getTime()]),[j]),N=(0,r.useMemo)(()=>(0,s.WI)([m,a,y]),[a,m]),F=(0,r.useMemo)(()=>(0,s.WI)([m,f]),[m,f]),S=(0,r.useCallback)(async()=>{let e;return c.get(N)?C:(d.set(N,F),u.has(y)?e=await (0,l.createRouteFetcherForAction)(v)(a):(e=await j,u.add(y)),d.get(N)===F&&(c.get(N)||w(e),d.delete(N)),e)},[N,F,v,a,C,w,y,u,j]),M=(0,s.Ay)(N,S,{revalidateOnMount:!1,...h}),I=(0,r.useCallback)(async e=>{let{serverMutate:t,optimisticData:a}=e;c.set(N,F),null!==a&&w(a);let l=await t;return c.get(N)===F&&c.delete(N),await M.mutate(S),l},[S,M,w,F,N]),U=void 0===M.data&&C===n.F||void 0===M.data&&!1,k=p&&C!==n.F;U&&!k&&(w((0,r.use)(j)),u.add(y));let T=C===n.F?o.M.get(b):C;return{...M,data:T,mutate:I}}},58659:(e,t,a)=>{a.d(t,{j:()=>r});var l=a(7336),n=a(4495);function r(e){let{count:t,max:a,className:r,displayThreshold:s,alertThreshold:i,message:o,messageThreshold:d,...c}=e;return s=null!=s?s:.75*a,d=null!=d?d:.9*a,i=null!=i?i:.95*a,(0,l.jsxs)("div",{className:(0,n.cn)("pointer-events-none items-center gap-2 rounded-md px-2 py-1 text-xs",t>=s?"flex":"hidden",t>=i?"text-red-500":"text-gray-500",r),...c,children:[o&&t>=d&&(0,l.jsx)("span",{children:o}),(0,l.jsxs)("span",{className:"ml-auto tabular-nums",children:[t.toLocaleString(),"/",a.toLocaleString()]})]})}},65010:(e,t,a)=>{a.d(t,{_:()=>n});var l=a(30009);let n=(0,l.createServerReference)("40801742a9a2ab9fe1be8221f86664e3930920c6aa",l.callServer,void 0,l.findSourceMapURL,"deleteChat")},72478:(e,t,a)=>{a.d(t,{F:()=>l});let l=null},75480:(e,t,a)=>{a.d(t,{Nt:()=>i,P4:()=>s});var l=a(27007),n=a(94585),r=a(72478);let s=(0,n.e)(null,()=>({getRateLimit:(0,l.eU)(r.F),getProjects:(0,l.eU)(r.F),getChats:(0,l.eU)(r.F),getScopes:(0,l.eU)(r.F),getUser:(0,l.eU)(r.F),getNewFeatureBanner:(0,l.eU)(r.F)})),i=(0,n.e)(null,()=>({...s()}))},75720:(e,t,a)=>{a.d(t,{ChatSidebarProvider:()=>c,e:()=>u});var l=a(7336),n=a(80644),r=a(93774),s=a(7363);let i=function(){let e=localStorage.getItem("sidebar");return document.documentElement.dataset.state="collapsed"===e?"collapsed":"expanded","collapsed"===e?"collapsed":"expanded"};var o=a(39695);let d=(0,n.createContext)({isCollapsed:!1,setCollapsed:()=>{},mobileSheetOpen:!1,setMobileSheetOpen:()=>{},actionChatId:null});function c(e){let{children:t}=e,a=(0,o.t)(),[c,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),f=(0,n.useCallback)(e=>{h(e),localStorage.setItem("sidebar",e?"collapsed":"expanded"),document.documentElement.dataset.state=e?"collapsed":"expanded"},[]);(0,n.useEffect)(()=>{null===m&&f("collapsed"===localStorage.getItem("sidebar"))},[]);let g=(0,n.useCallback)(e=>{"sidebar"===e.key&&f("collapsed"===i())},[f]);(0,n.useEffect)(()=>(window.addEventListener("storage",g),()=>window.removeEventListener("storage",g)));let{showDeleteDialogForChatId:x}=(0,r.v)(),{showShareDialog:p}=(0,s.B)();return(0,l.jsx)(d.Provider,{value:{isCollapsed:!a&&null!=m&&m,setCollapsed:a?()=>{}:f,mobileSheetOpen:c,setMobileSheetOpen:u,actionChatId:x||("object"==typeof p?p.chatId:null)},children:t})}let u=()=>(0,n.useContext)(d)},80060:(e,t,a)=>{a.d(t,{CreateTeamDialog:()=>o,F:()=>i});var l=a(7336),n=a(59103),r=a(38559),s=a(81616);function i(){let{data:e,mutate:t}=(0,n.Ay)("createTeamDialogOpen",null,{fallbackData:!1});return{createTeamDialogOpen:e,setCreateTeamDialogOpen:t}}function o(){let{createTeamDialogOpen:e,setCreateTeamDialogOpen:t}=i();return(0,l.jsxs)(r.Modal,{onOpenChange:t,open:e,children:[(0,l.jsxs)(r.ModalHeader,{children:[(0,l.jsx)(r.ModalTitle,{children:"Create a Team on Vercel"}),(0,l.jsxs)(r.ModalDescription,{children:["You will be redirected to"," ",(0,l.jsx)("span",{className:"font-medium",children:"vercel.com"})," to create a new Vercel team. If you create a Vercel Pro team, you will be charged for the Vercel Pro subscription in addition to the v0 Team plan."]})]}),(0,l.jsxs)(r.ModalFooter,{children:[(0,l.jsx)(s.$,{size:"sm",variant:"secondary",onClick:()=>t(!1),children:"Cancel"}),(0,l.jsx)(s.$,{size:"sm",asChild:!0,variant:"default",children:(0,l.jsx)("a",{href:"https://vercel.com/dashboard?createTeam=v0-checkout-page",target:"_blank",children:"Continue to Vercel"})})]})]})}},80890:(e,t,a)=>{a.d(t,{X:()=>r});var l=a(7336),n=a(4495);function r(e){let{className:t,...a}=e;return(0,l.jsx)("svg",{className:(0,n.cn)("h-4 w-4 animate-spin",t),fill:"currentColor",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg",...a,children:(0,l.jsx)("path",{d:"M232 128a104 104 0 0 1-208 0c0-41 23.81-78.36 60.66-95.27a8 8 0 0 1 6.68 14.54C60.15 61.59 40 93.27 40 128a88 88 0 0 0 176 0c0-34.73-20.15-66.41-51.34-80.73a8 8 0 0 1 6.68-14.54C208.19 49.64 232 87 232 128Z"})})}},80944:(e,t,a)=>{a.d(t,{default:()=>m,f:()=>h});var l=a(7336),n=a(80644),r=a(38559),s=a(81616),i=a(59103),o=a(3816),d=a(67952),c=a(2115),u=a(10299);function m(){let e=(0,d.k)("figmaIntegration"),{figmaOauthUrl:t,setSignInWithFigmaModal:a}=h(),i=(0,u.usePathname)()+(0,u.useSearchParams)().toString(),m=(0,u.useRouter)();(0,n.useEffect)(()=>{t&&(0,c.u)("FigmaAuthModalOpen")},[t]);let f=e=>{(0,c.u)("FigmaAuthModalClose",{reason:e}),a(null)},g=async()=>{let e=await fetch("/chat/api/integrations/figma/get-oauth-url?returnPath=".concat(encodeURIComponent(i))).then(e=>e.json()).then(e=>e.url);m.push(e)};return t?(0,l.jsx)(r.Modal,{onOpenChange:e=>!e&&f("cancel"),open:!!t,children:(0,l.jsxs)("div",{className:"grid gap-6",children:[(0,l.jsx)(r.ModalHeader,{className:"flex justify-start p-5",children:(0,l.jsxs)("div",{className:"flex w-full flex-col items-start gap-4",children:[(0,l.jsx)("div",{className:"bg-muted border-border flex items-center gap-2 rounded-lg p-2",children:(0,l.jsx)("div",{className:"rounded-lg border bg-white p-2",children:(0,l.jsx)(o.Y,{className:"text-muted-foreground h-6 w-6"})})}),(0,l.jsxs)("div",{className:"flex flex-col items-start gap-1.5",children:[(0,l.jsx)(r.ModalTitle,{className:"text-xl font-semibold",children:e("signInWithFigma")}),(0,l.jsx)(r.ModalDescription,{className:"text-sm text-zinc-500",children:e("signInDescription")})]})]})}),(0,l.jsx)(r.ModalFooter,{className:"border-border bg-muted border-t !p-4",children:(0,l.jsxs)("div",{className:"flex w-full items-center justify-end gap-4",children:[(0,l.jsx)(r.ModalClose,{asChild:!0,children:(0,l.jsx)(s.$,{onClick:()=>f("cancel"),size:"sm",variant:"secondary",children:e("cancel")})}),(0,l.jsx)(s.$,{onClick:g,size:"sm",variant:"default",autoFocus:!0,children:e("signIn")})]})})]})}):null}function h(){let{data:e,mutate:t}=(0,i.Ay)("signInWithFigmaModal",null);return{figmaOauthUrl:null==e?void 0:e.figmaOauthUrl,setSignInWithFigmaModal:t}}},91064:(e,t,a)=>{a.d(t,{N:()=>o});var l=a(7336),n=a(4495),r=a(38230),s=a.n(r),i=a(95057);function o(e){let{className:t,children:a,variant:r="default",external:o=!1,tooltip:d,disabled:c=!1,...u}=e,m=(0,l.jsx)(s(),{className:(0,n.cn)("marketing"===r&&"font-medium text-teal-700 hover:underline hover:underline-offset-2",c&&"cursor-not-allowed text-gray-400",t),target:o?"_blank":void 0,...u,children:a});return d?("string"==typeof d&&(d={content:d}),(0,l.jsx)(i.Tooltip,{...d,children:m})):m}},93774:(e,t,a)=>{a.d(t,{DeleteChatDialog:()=>j,v:()=>v});var l=a(7336),n=a(81616),r=a(15993),s=a(38559),i=a(59103),o=a(80644),d=a(10299),c=a(64854),u=a(2115),m=a(65010),h=a(75720),f=a(87825),g=a(67952),x=a(80890),p=a(88551);function v(){let{data:e,mutate:t}=(0,i.Ay)("showDeleteDialogForChatId",null);return{showDeleteDialogForChatId:e,setDeleteDialogForChatId:t}}function j(){let{showDeleteDialogForChatId:e,setDeleteDialogForChatId:t}=v(),a=(0,d.useRouter)(),i=(0,f.cy)(),[j,b]=(0,o.useTransition)(),{setData:C}=(0,c.m)(),{setMobileSheetOpen:w}=(0,h.e)(),y=(0,g.k)("deleteChatDialog");return(0,l.jsxs)(s.Modal,{onOpenChange:e=>{e||t(void 0)},open:void 0!==e,children:[(0,l.jsxs)(s.ModalHeader,{children:[(0,l.jsx)(s.ModalTitle,{children:y("title")}),(0,l.jsx)(s.ModalDescription,{children:y("description")})]}),(0,l.jsxs)(s.ModalFooter,{children:[(0,l.jsx)(s.ModalClose,{asChild:!0,children:(0,l.jsx)(n.$,{size:"sm",variant:"secondary",children:y("cancel")})}),(0,l.jsx)(n.$,{disabled:j,onClick:()=>{e&&b(async()=>{try{(0,u.u)("ClickDeleteChat",{targetChatId:e}),await (0,m._)({payload:{chatId:e}}),C(t=>t.filter(t=>t.chatId!==e)),t(void 0),r.oR.success(y("successToast")),i.id===e&&(w(!1),a.push("/chat"))}catch(e){(0,p.z)(e)||r.oR.error("Something went wrong. Please try again.")}})},size:"sm",variant:"destructive",children:j?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.X,{className:"size-4"}),y("deleting")]}):y("delete")})]})]})}},94585:(e,t,a)=>{function l(e,t){return function(){for(var a=arguments.length,l=Array(a),n=0;n<a;n++)l[n]=arguments[n];return e||(e=t(...l)),e}}function n(e,t,a){return function(l){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return(!e.has(l)||(null==a?void 0:a(l,e,r)))&&e.set(l,t(l,...r)),e.get(l)}}a.d(t,{G:()=>n,e:()=>l})}}]);